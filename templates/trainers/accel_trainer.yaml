{%- extends 'trainers/trainer.yaml' %}
{%- block trainer_meta_config %}
{{ super() }}
-- set trainer_def.name = "aiws.accel_trainer:AccelTrainer"
-- set trainer_def.description = "A lightweight, extensible trainer w/ Accelerate support"
{% endblock trainer_meta_config %}

{% block trainer_args %}
{{ super() }}
    accelerator_args:
        device_placement: True
        dataloader_config: !callable:accelerate:DataLoaderConfiguration
            dispatch_batches: False
            split_batches: False
{% endblock trainer_args %}

{% block trainer_constructor %}
.define: &trainer !callable:aiws.accel_trainer:AccelTrainer
    model: *model
    args: !callable:aiws.accel_trainer:AccelTrainingArguments
        <<: *trainer_args
    data_collator: *data_collator
    train_dataset: *train_dataset
    eval_dataset: *eval_dataset
    tokenizer: *tokenizer
    callbacks: *trainer_callbacks
{% endblock trainer_constructor -%}