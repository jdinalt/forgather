-- extends 'tokenizers/tokenizer_type.yaml'

[config_metadata]
    == super()
    -- set ns.config_class = ns.config_class + ".bpe"
    -- set ns.config_name = "Custom BPE Tokenizer"
    -- set ns.config_description = "A custom BPE tokenizer definition."
    ## -- set ns.dataset_id = 'dataset_id'
    ## -- set ns.output_dir = joinpath(ns.tokenizers_dir, 'custom_tokenizer')

[tokenizer_trainer]
    == super()
    model: !call:tokenizers:models.BPE
        cache_capacity: 16
        unk_token: "{{ ns.unk_token }}"
        byte_fallback: True
    normalizer: !call:tokenizers:normalizers.NFC []
    pre_tokenizer: !call:tokenizers:pre_tokenizers.ByteLevel []
    decoder: !call:tokenizers:decoders.ByteLevel []
    # Automatically add bos token to sequence start
    post_processor: !call:tokenizers:processors.TemplateProcessing
        single: "<bos> $A"
        special_tokens: [ !tuple [ "<bos>", {{ ns.bos_token_id }} ] ]
    trainer: !call:tokenizers.trainers:BpeTrainer
        vocab_size: {{ ns.vocab_size }}
        initial_alphabet: !call:tokenizers:pre_tokenizers.ByteLevel.alphabet []
        special_tokens: !call:list [!singleton:values [*special_tokens_map]]
        show_progress: False