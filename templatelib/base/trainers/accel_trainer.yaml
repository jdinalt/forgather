-- extends 'trainers/trainer.yaml'
[trainer_meta_config]
    == super()
    -- set ns.trainer_name = "forgather.ml.trainer.accelerate:AccelTrainer"
    -- set ns.trainer_description = "A lightweight, extensible trainer w/ Accelerate support"
    -- set ns.nproc_per_node = "gpu"
    -- set ns.trainer_config_class = "forgather.ml.trainer.accelerate:AccelTrainingArguments"
    -- set ns.trainer_class = "forgather.ml.trainer.accelerate:AccelTrainer"

## Note: The distributed_env class must be an AcceDistEnv. e.g.
## distributed_env: &distributed_env !call:forgather.ml.trainer.accelerate:AccelDistEnv@distributed_env
##    - !call:accelerate:Accelerator []
[trainer_dependencies]
    == super()
    [accel_dataloader_config]
.define: &accel_dataloader_config !call:accelerate:DataLoaderConfiguration
    use_stateful_dataloader: True
    
    [accelerator]
accelerator: &accelerator !call:accelerate:Accelerator
    dataloader_config: *accel_dataloader_config
    project_dir: "{{ ns.output_dir }}"

[trainer_constructor]
    == super()
    # **Accel Trainer**
    accelerator: *accelerator
