-- extends 'callbacks/base_callbacks.yaml'

[callback_dependencies]
# Resumable TensorBoard SummaryWriter wrapper
.define: &summary_writer !singleton:forgather.ml.trainer.callbacks:ResumableSummaryWriter
    log_dir: "{{ ns.logging_dir }}"

    [experiment_info]
# Additional data to record to experiment loggers
experiment_info: &experiment_info !dict:@experiment_info
    date: "{{ utcisotime() }}"
    name: "{{ ns.config_name }}"
    description: "{{ ns.config_description }}"
    config: !var "pp_config"
    versions: {{ versions }}

[callback_list]
    => super()
    # ResumableSummaryWriter registered as callback for checkpoint state persistence
    resumable_writer: *summary_writer

    # Log all training output to JSON
    json_logger: !singleton:forgather.ml.trainer.callbacks:JsonLogger
        <<: *experiment_info

    # Log configuration and metrics to Tensorboard file
    tb_logger: !singleton:forgather.ml.trainer.callbacks:TBLogger
        arg0: *summary_writer
        <<: *experiment_info
