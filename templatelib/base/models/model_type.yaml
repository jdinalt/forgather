-- extends 'config_type.yaml'

## Optional
[config_metadata]
    == super()
    -- set ns.config_class = ns.config_class + ".model"

[globals]
    -- set ns.output_dir = output_dir | default(joinpath(ns.models_dir, ns.model_name))

[header]
    == super()
# Model: {{ ns.model_name }}

[variable_listing]
    == super()
# ns.model_src_dir: "{{ abspath(ns.model_src_dir) }}"
# ns.output_dir: "{{ abspath(ns.output_dir) }}"

[main_body]

== h2('Model')

    [model_constructor_args]
.define: &model_constructor_args
    attn_implementation: "{{ attn_implementation | default('sdpa') }}"

    [model_definition]
## tokenizer: &tokenizer
## model: &model

[dynamic_args]
    == super()
    attn_implementation:
        names: "--attn-implementation"
        type: "str"
        choices: [ "eager", "sdpa", "flash_attention_2", "flex_attention" ]
        help: "Attention implementation"

[meta_output]
    == super()
    output_dir: "{{ ns.output_dir }}"
    model_src_dir: "{{ ns.model_src_dir }}"

[main_output]
main:
    config: *pretrained_config
    tokenizer: *pretrained_tokenizer
    model_ctor: *model
