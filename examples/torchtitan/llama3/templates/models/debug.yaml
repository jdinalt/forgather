-- extends "llama3.yaml"

## Derived from: torchtitan/config/models/llama3/model/train_configs/debug_model.toml
[config_metadata]
    == super()
    -- set ns.config_name = "Debug Model"
    -- set ns.config_description = "Llama 3 debug training"
    -- set ns.model_name = "debug_model"
    -- set ns.tokenizer_name = joinpath(ns.tokenizers_dir, "wikitext_2k")
    -- set ns.tokenizer_config = "2k.yaml"
    -- set ns.nproc_per_node = 1

[profiling]
    => super()
    enable_profiling: false
    save_traces_folder: "profile_trace"
    profile_freq: 10
    enable_memory_snapshot: false
    save_memory_snapshot_folder: "memory_snapshot"

[metrics]
    => super()
    log_freq: 1
    disable_color_printing: false
    enable_tensorboard: false
    save_tb_folder: "tb"
    enable_wandb: false

[model]
    => super()
    flavor: "debugmodel"
    # converters: ["float8"]

[optimizer]
    => super()
    name: "AdamW"
    lr: !!float 8e-4
    eps: !!float 1e-8

[lr_scheduler]
    => super()
    warmup_steps: 2  # lr scheduler warm up, normally 20% of the train steps
    decay_ratio: 0.8  # lr scheduler decay ratio, 80% of the train steps
    decay_type: "linear"
    min_lr_factor: 0.0

[training]
    => super()
    local_batch_size: 8
    seq_len: 2048
    max_norm: 1.0  # grad norm clipping

[parallelism]
    => super()
    data_parallel_replicate_degree: 1
    data_parallel_shard_degree: -1
    fsdp_reshard_after_forward: "default" # default / never / always
    tensor_parallel_degree: 1
    enable_async_tensor_parallel: false
    pipeline_parallel_degree: 1
    context_parallel_degree: 1

[checkpoint]
    => super()
    enable: false
    folder: "checkpoint"
    interval: 10
    last_save_model_only: false
    export_dtype: "float32"
    async_mode: "disabled"  # ["disabled", "async", "async_with_pinned_mem"]

[activation_checkpoint]
    => super()
    mode: "selective"  # ["none", "selective", "full"]
    selective_ac_option: '2'  # 'int' = ac every positive int layer or 'op', ac based on ops policy

[compile]
    => super()
    enable: false
    components: ["model", "loss"]

[float8]
    => super()
    enable_fsdp_float8_all_gather: false
    precompute_float8_dynamic_scale_for_fsdp: false
    filter_fqns: ["output"]

[validation]
    => super()
    enable: false
    dataset: "c4_validation"
    freq: 5
    steps: 10
